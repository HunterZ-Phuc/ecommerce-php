RewriteEngine On

# Thiết lập base path cho project
RewriteBase /ecommerce-php/

# Tạo alias cho trang lỗi trước
RewriteRule ^404/?$ src/views/404.php [L]
RewriteRule ^503/?$ src/views/503.php [L]

# Thiết lập trang lỗi mặc định
ErrorDocument 404 /ecommerce-php/src/views/404.php
ErrorDocument 403 /ecommerce-php/src/views/404.php
ErrorDocument 500 /ecommerce-php/503

# Cho phép truy cập trực tiếp vào các thư mục và file tĩnh
RewriteCond %{REQUEST_URI} !^/ecommerce-php/assets/.*$ [NC]
RewriteCond %{REQUEST_URI} !^/ecommerce-php/uploads/.*$ [NC]
RewriteCond %{REQUEST_URI} !^/ecommerce-php/src/assets/.*$ [NC]
RewriteCond %{REQUEST_URI} !.*\.(jpg|jpeg|png|gif|css|js|ico)$ [NC]

# Điều hướng trang chủ
RewriteRule ^$ index.php [L]

# Điều hướng các trang chính
RewriteRule ^shop/?$ src/views/shop.php [L]
RewriteRule ^about/?$ src/views/about.php [L]
RewriteRule ^contact/?$ src/views/contact.php [L]
RewriteRule ^service/?$ src/views/service.php [L]
RewriteRule ^cart/?$ src/views/cart.php [L]

# Điều hướng trang quản lý
RewriteRule ^admin/?$ src/views/management/adminManagement/dashboard.php [L]
RewriteRule ^admin/products/?$ src/views/management/productManagement/productManagement.php [L]

# Điều hướng trang xác thực
RewriteRule ^login/?$ src/views/management/login/login.php [L]
RewriteRule ^forgot-password/?$ src/views/management/forgotPassword/forgotPassword.php [L]

# Điều hướng trang chi tiết sản phẩm
RewriteRule ^product/([0-9]+)/?$ src/views/product.php?id=$1 [L,QSA]

# Điều hướng trang danh mục
RewriteRule ^category/([^/]+)/?$ src/views/shop.php?category=$1 [L,QSA]

# Điều hướng trang tìm kiếm
RewriteRule ^search/?$ src/views/result.php [L,QSA]

# Điều hướng trang tài khoản khách hàng
RewriteRule ^account/?$ src/views/customer/my_account.php [L]

# Chặn truy cập trực tiếp vào thư mục src/views và hiển thị nội dung 404.php
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s/+ecommerce-php/src/views/.* [NC]
RewriteRule ^ src/views/404.php [L]

# Rule xử lý 404 ở cuối
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /ecommerce-php/404 [L]
